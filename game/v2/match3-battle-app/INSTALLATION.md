# 安装和使用指南

本指南将帮助你快速安装和运行多人实时对战消消乐 App。

## 目录
1. [系统要求](#系统要求)
2. [安装 Node.js](#安装-nodejs)
3. [下载项目](#下载项目)
4. [安装依赖](#安装依赖)
5. [启动服务器](#启动服务器)
6. [游戏说明](#游戏说明)
7. [常见问题](#常见问题)

---

## 系统要求

### 最低配置
- **操作系统**: Windows 7+, macOS 10.12+, Linux (Ubuntu 18.04+)
- **Node.js**: 14.0 或更高版本
- **内存**: 512 MB RAM
- **浏览器**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

### 推荐配置
- **操作系统**: Windows 10/11, macOS 12+, Ubuntu 20.04+
- **Node.js**: 18.0 或更高版本
- **内存**: 1 GB RAM
- **浏览器**: 最新版本的 Chrome 或 Firefox

---

## 安装 Node.js

### Windows 系统

1. 访问 Node.js 官网：https://nodejs.org/
2. 下载 LTS（长期支持）版本
3. 运行安装程序
4. 安装过程中保持默认选项
5. 完成后打开命令提示符，输入以下命令验证：
   ```cmd
   node --version
   npm --version
   ```

### macOS 系统

**方法 1: 使用官方安装包**
1. 访问 https://nodejs.org/
2. 下载 macOS 安装包
3. 双击 .pkg 文件安装

**方法 2: 使用 Homebrew**
```bash
brew install node
```

**验证安装**
```bash
node --version
npm --version
```

### Linux 系统 (Ubuntu/Debian)

```bash
# 更新包管理器
sudo apt update

# 安装 Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 验证安装
node --version
npm --version
```

---

## 下载项目

### 方法 1: 使用 Git (推荐)

```bash
# 克隆项目
git clone <项目地址>
cd match3-battle-app
```

### 方法 2: 直接下载

1. 下载项目 ZIP 文件
2. 解压到任意目录
3. 打开终端/命令提示符，进入项目目录

---

## 安装依赖

### 自动安装 (推荐)

**Windows 用户**
```cmd
双击运行 start.bat
```

**macOS/Linux 用户**
```bash
./start.sh
```

脚本会自动检测并安装所需依赖。

### 手动安装

```bash
# 进入服务器目录
cd server

# 安装依赖
npm install
```

---

## 启动服务器

### 使用启动脚本 (推荐)

**Windows**
```cmd
start.bat
```

**macOS/Linux**
```bash
./start.sh
```

### 手动启动

```bash
cd server
npm start
```

### 成功启动的标志

当看到以下信息时，表示服务器成功启动：

```
服务器运行在 http://localhost:3000
WebSocket 服务器已启动
```

---

## 访问游戏

### 本地访问

1. 打开浏览器
2. 访问：`http://localhost:3000`
3. 开始游戏！

### 局域网访问

**查找本机 IP 地址**

**Windows**
```cmd
ipconfig
```
查找 "IPv4 地址"

**macOS/Linux**
```bash
ifconfig
# 或
ip addr show
```

**其他设备访问**
```
http://你的IP地址:3000
```
例如: `http://192.168.1.100:3000`

---

## 游戏说明

### 快速开始

#### 创建房间
1. 点击「创建房间」
2. 输入你的昵称（1-12个字符）
3. 获取 6 位房间号
4. 将房间号分享给朋友
5. 等待朋友加入
6. 点击「开始游戏」

#### 加入房间
1. 点击「加入房间」
2. 输入 6 位房间号
3. 输入你的昵称
4. 等待房主开始游戏

#### 随机匹配
1. 点击「随机匹配」
2. 系统自动匹配对手
3. 匹配成功后自动开始

### 游戏规则

**基本操作**
- 点击一个宝石
- 再点击相邻的宝石进行交换
- 相邻定义：上、下、左、右四个方向

**消除规则**
- 横向或纵向连续 3 个或以上相同颜色宝石会被消除
- 消除后上方宝石自动下落
- 空位自动填充新宝石
- 支持连锁消除

**计分规则**
- 每消除 1 个宝石得 10 分
- 连锁消除可以快速得分

**游戏时长**
- 每局游戏 60 秒
- 倒计时结束游戏自动结束

**胜负判定**
- 时间结束时分数高者获胜
- 平局时双方都算平局

### 聊天功能

**发送文字消息**
1. 点击右下角聊天按钮
2. 在输入框输入消息
3. 按回车或点击发送按钮

**发送表情**
- 点击预设的表情按钮快速发送

---

## 常见问题

### Q1: 无法连接到服务器怎么办？

**检查项：**
1. 确认服务器已启动
2. 检查防火墙设置
3. 确认端口 3000 未被占用
4. 刷新浏览器页面

**解决方案：**
```bash
# 检查端口占用 (Windows)
netstat -ano | findstr :3000

# 检查端口占用 (macOS/Linux)
lsof -i :3000

# 更改端口
# 在 server/server.js 中修改 PORT 常量
```

### Q2: 安装依赖时出现错误

**解决方案：**
```bash
# 清理缓存
npm cache clean --force

# 删除 node_modules
rm -rf node_modules

# 重新安装
npm install
```

### Q3: 游戏卡顿或延迟高

**可能原因：**
- 网络连接不稳定
- 服务器性能不足
- 浏览器性能问题

**解决方案：**
1. 检查网络连接
2. 关闭其他占用资源的程序
3. 使用更高性能的设备
4. 更换浏览器

### Q4: 手机访问游戏

**步骤：**
1. 确保手机和电脑在同一 WiFi 网络
2. 在电脑上查找 IP 地址
3. 在手机浏览器访问：`http://电脑IP:3000`
4. 将页面添加到主屏幕以获得类似 App 的体验

### Q5: 如何停止服务器？

**方法：**
- 在终端/命令提示符中按 `Ctrl + C`
- 关闭终端窗口

### Q6: 房间号过期了怎么办？

**说明：**
- 房间在创建 30 分钟后如果无活动会自动清理
- 玩家离开房间后，房间会立即删除

**解决方案：**
- 重新创建房间

### Q7: 如何在生产环境部署？

**推荐方案：**
1. 使用 PM2 进程管理
   ```bash
   npm install -g pm2
   pm2 start server/server.js --name match3-battle
   ```

2. 配置 Nginx 反向代理
3. 申请 SSL 证书启用 HTTPS
4. 配置域名解析

---

## 技术支持

如遇到其他问题，请：
1. 查看项目 README.md
2. 检查浏览器控制台错误信息
3. 查看服务器日志输出
4. 提交 GitHub Issue

---

## 更新日志

### v1.0.0 (当前版本)
- ✅ 基础三消游戏逻辑
- ✅ WebSocket 实时对战
- ✅ 房间系统（创建/加入/匹配）
- ✅ 即时聊天功能
- ✅ 计分和胜负判定

---

**祝你游戏愉快！🎮**
